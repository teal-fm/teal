CREATE MATERIALIZED VIEW "public"."mv_top_artists_for_user_30days" AS (select "artists"."mbid", "artists"."name", count("plays"."uri") as "play_count" from "artists" inner join "play_to_artists" on "artists"."mbid" = "play_to_artists"."artist_mbid" inner join "plays" on "plays"."uri" = "play_to_artists"."play_uri" inner join "profiles" on "profiles"."did" = "plays"."did" where "plays"."played_time" >= NOW() - INTERVAL '30 days' group by "artists"."mbid", "artists"."name" order by count("plays"."uri") DESC);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."mv_top_artists_for_user_7days" AS (select "artists"."mbid", "artists"."name", count("plays"."uri") as "play_count" from "artists" inner join "play_to_artists" on "artists"."mbid" = "play_to_artists"."artist_mbid" inner join "plays" on "plays"."uri" = "play_to_artists"."play_uri" inner join "profiles" on "profiles"."did" = "plays"."did" where "plays"."played_time" >= NOW() - INTERVAL '7 days' group by "artists"."mbid", "artists"."name" order by count("plays"."uri") DESC);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."mv_top_releases_for_user_30days" AS (select "releases"."mbid", "releases"."name", count("plays"."uri") as "play_count" from "releases" inner join "plays" on "plays"."release_mbid" = "releases"."mbid" inner join "profiles" on "profiles"."did" = "plays"."did" where "plays"."played_time" >= NOW() - INTERVAL '30 days' group by "releases"."mbid", "releases"."name" order by count("plays"."uri") DESC);--> statement-breakpoint
CREATE MATERIALIZED VIEW "public"."mv_top_releases_for_user_7days" AS (select "releases"."mbid", "releases"."name", count("plays"."uri") as "play_count" from "releases" inner join "plays" on "plays"."release_mbid" = "releases"."mbid" inner join "profiles" on "profiles"."did" = "plays"."did" where "plays"."played_time" >= NOW() - INTERVAL '7 days' group by "releases"."mbid", "releases"."name" order by count("plays"."uri") DESC);